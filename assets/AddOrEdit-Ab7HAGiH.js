import{B as e,D as r,dE as t,an as n,bU as a,dF as l,b9 as o,A as u,_ as i,dG as g,C as d,aj as s,aw as c,S as h,aM as p,aE as v,dH as m,ag as y,l as f,ab as C,$ as b,ah as w,R as $,z as x,bt as _,aY as S,T as k,o as O,aA as T,L as I,M as F,E as H,bu as j,F as R,G as E,J as z,K as M,bE as N,a8 as P,a9 as B,I as q,bQ as G,bF as D,bW as A,aR as L,bR as J,j as K,bq as Q,bV as U,c0 as V,r as W,ao as X,bT as Y}from"./index-C_g2pi0Z.js";import{r as Z,g as ee}from"./share-CvvitCHF.js";import{T as re}from"./item_type-Bo2djN9R.js";import{R as te}from"./ResponsiveGrid-Dzear67t.js";import{o as ne,E as ae,G as le,H as oe,I as ue,n as ie}from"./index-DJbwiRYC.js";const ge=t(),de=t=>{var a;const[l,o]=e("/");return null==(a=t.handle)||a.call(t,{setPath:o}),r(n,{class:"folder-tree-box",w:"$full",overflowX:"auto",get children(){return r(ge.Provider,{get value(){var e,r,n,a;return{value:l,onChange:e=>{o(e),t.onChange(e)},autoOpen:null!=(e=t.autoOpen)&&e,forceRoot:null!=(r=t.forceRoot)&&r,showEmptyIcon:null!=(n=t.showEmptyIcon)&&n,showHiddenFolder:null==(a=t.showHiddenFolder)||a}},get children(){return r(se,{path:"/"})}})}})},se=t=>{const{isHidePath:S}=a(),[k,O]=e(),{value:T,onChange:I,forceRoot:F,autoOpen:H,showEmptyIcon:j,showHiddenFolder:R}=l(ge),[E,z]=o(()=>u(t.path,i(),1,0,!1));let M=!1;const N=async()=>{var e;if(null==(e=k())?void 0:e.length)return;const r=await z();_(r,e=>{M=!0,O(e.content||[])},()=>{P()&&B()})},{isOpen:P,onToggle:B}=function(){const[r,t]=e(!1);return{isOpen:r,onToggle:()=>t(!r()),onOpen:()=>t(!0),onClose:()=>t(!1)}}(),q=()=>T()===t.path,G=g(t.path);return d(s(T,async e=>{H&&G(e)&&(P()||B(),M||N())})),r(h,{get when(){return R||!(S(t.path)&&!G(T()))},get children(){return r(n,{get children(){return[r(c,{spacing:"$2",get children(){return[r(h,{get when(){return!E()},get fallback(){return r(m,{size:"sm",get color(){return v()}})},get children(){return r(h,{get when(){return!Boolean(j&&void 0!==k()&&!(null==(e=k())?void 0:e.length));var e},get fallback(){return r(p,{get color(){return v()},as:ae})},get children(){return r(p,{get color(){return v()},as:ne,get transform(){return P()?"rotate(90deg)":"none"},transition:"transform 0.2s",cursor:"pointer",onClick:()=>{B(),P()&&N()}})}})}}),r(p,{get color(){return v()},as:le,cursor:"pointer"}),r(y,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return q()?"$info8":"transparent"},get _hover(){return{bgColor:q()?"$info8":b()}},onClick:()=>{I(t.path)},get children(){return C(()=>"/"===t.path)()?"root":f(t.path)}})]}}),r(h,{get when(){return P()},get children(){return r(w,{mt:"$1",pl:"$4",alignItems:"start",spacing:"$1",get children(){return[r($,{get each(){return(null==(e=k())?void 0:e.filter(e=>e.is_dir))||[];var e},children:e=>r(se,{get path(){return x(t.path,e.name)}})}),r($,{get each(){return(null==(e=k())?void 0:e.filter(e=>!e.is_dir))||[];var e},children:e=>r(c,{spacing:"$2",w:"$full",get children(){return[r(n,{w:"16px"}),r(p,{get color(){return v()},as:oe,cursor:"pointer"}),r(y,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return T()===x(t.path,e.name)?"$info8":"transparent"},get _hover(){return{bgColor:T()===x(t.path,e.name)?"$info8":b()}},onClick:()=>{I(x(t.path,e.name))},get children(){return e.name}})]}})})]}})}})]}})}})},ce=t=>{const n=O(),{isOpen:a,onOpen:l,onClose:o}=S(),[u,i]=e("/"),g=()=>{const e=[...t.value?t.value.split("\n"):[],u()].filter(Boolean),r=[...new Set(e)];t.onChange(r.join("\n")),o()};return r(w,{w:"$full",spacing:"$2",alignItems:"stretch",get children(){return[r(c,{w:"$full",spacing:"$2",get children(){return[r(k,{get id(){return t.id},flex:"1",get value(){return t.value},get invalid(){return!t.valid},get readOnly(){return t.readOnly},get placeholder(){return t.placeholder||n("shares.files_placeholder")},onInput:e=>t.onChange(e.currentTarget.value)}),r(T,{colorScheme:"accent",get"aria-label"(){return n("global.choose_or_input_path")},get icon(){return r(le,{})},onClick:l,size:"lg",get disabled(){return t.readOnly}})]}}),r(I,{size:"xl",get opened(){return a()},onClose:o,get children(){return[r(F,{}),r(H,{get children(){return[r(j,{}),r(R,{get children(){return n("global.choose_or_input_path")}}),r(E,{get children(){return r(de,{forceRoot:!0,onChange:i,showHiddenFolder:!0})}}),r(z,{display:"flex",gap:"$2",get children(){return[r(M,{onClick:o,colorScheme:"neutral",get children(){return n("global.cancel")}}),r(M,{onClick:g,colorScheme:"primary",get leftIcon(){return r(ue,{})},get children(){return n("shares.add_path")}})]}})]}})]}})]}})},he=e=>{const t=O();return r(J,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[r(N,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var r;return t(null!=(r=e.full_name_path)?r:`shares.${e.name}`)}}),r(P,{get fallback(){return r(L,{get children(){return t("settings.unknown_type")}})},get children(){return[r(B,{get when(){return e.type===re.String},get children(){return r(c,{w:"$full",spacing:"$2",get children(){return[r(q,{get id(){return e.name},type:"text",get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onChange(){return e.type===re.String?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r.currentTarget.value)}:void 0}}),r(h,{get when(){return e.type===re.String&&e.random},get children(){return r(T,{colorScheme:"neutral","aria-label":"random",get icon(){return r(ie,{})},get onClick(){return e.type===re.String?()=>{var r;return null==(r=e.onChange)?void 0:r.call(e,e.random())}:void 0}})}})]}})}}),r(B,{get when(){return e.type===re.Number},get children(){return r(q,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onInput(){return e.type===re.Number?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,parseInt(r.currentTarget.value))}:void 0}})}}),r(B,{get when(){return e.type===re.Float},get children(){return r(q,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onInput(){return e.type===re.Float?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,parseFloat(r.currentTarget.value))}:void 0}})}}),r(B,{get when(){return e.type===re.Bool},get children(){return r(G,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get invalid(){return!e.valid},get onChange(){return e.type===re.Bool?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r.currentTarget.checked)}:void 0}})}}),r(B,{get when(){return e.type===re.Text},get children(){return r(k,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onChange(){return e.type===re.Text?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r.currentTarget.value)}:void 0}})}}),r(B,{get when(){return e.type===re.MultiPath},get children(){return r(ce,{get id(){return e.name},get value(){return e.value},get valid(){return e.valid},get readOnly(){return e.readonly},onChange:r=>{var t;e.type===re.MultiPath&&(null==(t=e.onChange)||t.call(e,r))}})}}),r(B,{get when(){return e.type===re.Select},get children(){return r(D,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get onChange(){return e.type===re.Select?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r)}:void 0},get children(){return r(A,{get readonly(){return e.readonly},get searchable(){return e.type===re.Select&&e.searchable},get options(){return e.options.split(",").map(r=>{var n;return{key:r,label:t((null!=(n=e.options_prefix)?n:`shares.${e.name}s`)+`.${r}`)}})}})}})}})]}})]}})},pe=()=>{const t=O(),{params:n,back:a,to:l}=K(),{id:u}=n,[i,g]=o(()=>Q.get(`/share/get?id=${u}`),!0),[d,s]=U({}),[c,p]=e(""),[v,m]=e(!1),[y,f]=e(""),[C,b]=e(!0);u&&(async()=>{const e=await g();_(e,e=>{Y(()=>{s(e),p(e.files.join("\n")),e.expires&&f(new Date(e.expires).toLocaleString()),m(!0)})})})();const[w,$]=o(()=>Q.post("/share/"+(u?"update":"create"),d));return r(X,{get loading(){return!!u&&i()},get children(){return[r(V,{mb:"$2",get children(){return t("global."+(u?"edit":"add"))}}),r(te,{get children(){return[r(h,{when:u,get children(){return r(he,{name:"id",get type(){return re.String},value:u,valid:!0,readonly:!0})}}),r(he,{name:"files",get type(){return re.MultiPath},get value(){return c()},get valid(){return v()},required:!0,onChange:e=>{p(e),m(e.length>0),s("files",e.split("\n"))}}),r(he,{name:"remark",get type(){return re.Text},get value(){return d.remark},valid:!0,onChange:e=>{s("remark",e)}}),r(he,{name:"extract_folder",get type(){return re.Select},get value(){return d.extract_folder},valid:!0,options:"front,back",onChange:e=>{s("extract_folder",e)}}),r(he,{name:"order_by",get type(){return re.Select},get value(){return d.order_by},valid:!0,options:"name,size,modified",onChange:e=>{s("order_by",e)}}),r(he,{name:"order_direction",get type(){return re.Select},get value(){return d.order_direction},valid:!0,options:"asc,desc",onChange:e=>{s("order_direction",e)}}),r(he,{name:"pwd",get type(){return re.String},get value(){return d.pwd},valid:!0,onChange:e=>{s("pwd",e)},random:Z}),r(he,{name:"max_accessed",get type(){return re.Number},get value(){return d.max_accessed},valid:!0,onChange:e=>{s("max_accessed",e)}}),r(h,{when:u,get children(){return r(he,{name:"accessed",get type(){return re.Number},get value(){return d.accessed},valid:!0,onChange:e=>{s({...d,accessed:e})}})}}),r(he,{name:"expires",get type(){return re.String},get value(){return y()},get valid(){return C()},placeholder:"yyyy-MM-dd HH:mm:ss or +1w1d1H1m1s1ms",onChange:e=>{if(f(e),""===e)return b(!0),void s("expires",null);const r=ee(e);isNaN(r.getTime())?b(!1):(b(!0),s("expires",r.toISOString()))}}),r(he,{name:"readme",get type(){return re.Text},get value(){return d.readme},valid:!0,onChange:e=>{s("readme",e)}}),r(he,{name:"header",get type(){return re.Text},get value(){return d.header},valid:!0,onChange:e=>{s("header",e)}})]}}),r(M,{mt:"$2",get disabled(){return!C()||!v()},get loading(){return w()},onClick:async()=>{const e=await $();_(e,()=>{W.success(t("global.save_success")),a()},(r,t)=>{e.data.id&&l(`/@manage/shares/edit/${e.data.id}`)})},get children(){return t("global."+(u?"save":"add"))}})]}})};export{pe as default};
