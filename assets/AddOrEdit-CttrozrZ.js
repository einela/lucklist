function e(e,r){switch(e){case q.Bool:return!!r&&"true"===r;case q.Number:return r?parseInt(r):0;case q.Float:return r?parseFloat(r):0;default:return r||""}}import{D as r,bE as t,o as n,a8 as a,a9 as l,I as u,bQ as i,T as d,bF as o,bW as s,aR as g,S as c,H as v,bR as m,j as p,b9 as h,bq as y,B as f,bV as b,O as w,c0 as $,ah as C,dD as _,db as x,ab as O,dc as k,R as S,Q as T,K as j,r as F,Y as I,bt as N,ao as R}from"./index-C_g2pi0Z.js";import{T as q}from"./item_type-Bo2djN9R.js";import{R as B}from"./ResponsiveGrid-Dzear67t.js";const D=e=>{const p=n();return r(m,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[r(t,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var r;return p((null!=(r=e.full_name_path)?r:"common"===e.driver)?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),r(a,{get fallback(){return r(g,{get children(){return p("settings.unknown_type")}})},get children(){return[r(l,{get when(){return e.type===q.String},get children(){return r(u,{get id(){return e.name},get type(){return"password"==e.name?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===q.String?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r.currentTarget.value)}:void 0}})}}),r(l,{get when(){return e.type===q.Number},get children(){return r(u,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===q.Number?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,parseInt(r.currentTarget.value))}:void 0}})}}),r(l,{get when(){return e.type===q.Float},get children(){return r(u,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===q.Float?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,parseFloat(r.currentTarget.value))}:void 0}})}}),r(l,{get when(){return e.type===q.Bool},get children(){return r(i,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===q.Bool?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r.currentTarget.checked)}:void 0}})}}),r(l,{get when(){return e.type===q.Text},get children(){return r(d,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===q.Text?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r.currentTarget.value)}:void 0}})}}),r(l,{get when(){return e.type===q.Select},get children(){return r(o,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===q.Select?r=>{var t;return null==(t=e.onChange)?void 0:t.call(e,r)}:void 0},get children(){return r(s,{get readonly(){return e.readonly},get searchable(){return e.type===q.Select&&e.searchable},get options(){return e.options.split(",").map(r=>{var t;return{key:r,label:p((null!=(t=e.options_prefix)?t:"common"===e.driver?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`)+`.${r}`)}})}})}})}})]}}),r(c,{get when(){return e.help},get children(){return r(v,{get children(){return p("common"===e.driver?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})},J=()=>{const t=n(),{params:a,back:l,to:u}=p(),{id:i}=a,[d,o]=h(()=>y.get("/admin/driver/list"),!0),[s,g]=f({}),[v,m]=h(()=>y.get(`/admin/storage/get?id=${i}`),!0),[J,Q]=h(()=>y.get(`/admin/driver/info?driver=${V.driver}`),!0);i?(async()=>{const e=await m();N(e,async e=>{E(e),H(JSON.parse(e.addition));const r=await Q();N(r,e=>g({[V.driver]:e}))})})():(async()=>{const e=await o();N(e,g)})();const[V,E]=b({}),[G,H]=b({}),[K,W]=h(()=>(E("addition",JSON.stringify(G)),y.post("/admin/storage/"+(i?"update":"create"),V))),Y=w(()=>{var e;const r=null==(e=s()[V.driver])?void 0:e.config.alert;if(console.log(r),r)return r.split("|")[0]});return r(R,{get loading(){return i?v()||J():d()},get children(){return[r($,{mb:"$2",get children(){return t("global."+(i?"edit":"add"))}}),r(C,{mb:"$2",spacing:"$2",get children(){return[r(D,{name:"driver",default:"",readonly:void 0!==i,required:!0,searchable:!0,get type(){return q.Select},get options(){return i?V.driver:Object.keys(s()).join(",")},get value(){return V.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:r=>{for(const t of s()[r].common)E(t.name,e(t.type,t.default));H(_(e=>{for(const r in e)delete e[r]}));for(const t of s()[r].additional)H(t.name,e(t.type,t.default));E("driver",r)}}),r(c,{get when(){return Y()},get children(){return r(x,{get status(){return Y()},w:"$full",get children(){return[r(k,{}),O(()=>t(`drivers.config.${V.driver}.alert`))]}})}})]}}),r(B,{get children(){return r(c,{get when(){return s()[V.driver]},get children(){return[r(S,{get each(){return s()[V.driver].common},children:e=>r(D,T(e,{driver:"common",get value(){return V[e.name]},onChange:r=>{E(e.name,r)}}))}),r(S,{get each(){return s()[V.driver].additional},children:e=>r(D,T(e,{get driver(){return V.driver},get value(){return G[e.name]},onChange:r=>{H(e.name,r)}}))})]}})}}),r(j,{mt:"$2",get loading(){return K()},onClick:async()=>{s()[V.driver].config.need_ms&&(F.info(t("manage.add_storage-tips")),window.open(I("/@manage/messenger"),"_blank"));const e=await W();N(e,()=>{F.success(t("global.save_success")),l()},(r,t)=>{e.data.id&&u(`/@manage/storages/edit/${e.data.id}`)})},get children(){return t("global."+(i?"save":"add"))}})]}})};export{J as default};
