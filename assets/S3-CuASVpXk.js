import{D as e,bR as t,bE as n,o as s,I as r,cy as a,K as i,R as l,Q as c,ah as o,b9 as g,bq as u,bV as d,df as m,B as h,dg as p,S as f,bt as y,r as k,c0 as b,aw as _,dh as v,di as w}from"./index-C_g2pi0Z.js";import{b as x}from"./useTitle-a7nPsmVE.js";import{G as S}from"./index-DYpWq1ju.js";import{I as $}from"./SettingItem-CR5VVA99.js";import{R as j}from"./ResponsiveGrid-Dzear67t.js";import{a as C}from"./FolderTree-BBXJf3vD.js";import{c as I}from"./index-B5f7FnMG.js";import"./index-DJbwiRYC.js";import"./index-CRWiqiAK.js";import"./item_type-Bo2djN9R.js";const D=l=>{const c=s();return e(a,{w:"$full",overflowX:"auto",shadow:"$md",rounded:"$lg",p:"$2",direction:{"@initial":"column","@xl":"row"},spacing:"$2",get children(){return[e(t,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(n,{for:"path",display:"flex",alignItems:"center",get children(){return c("global.name")}}),e(r,{id:"name",get value(){return l.name},onChange:e=>l.onChange({...l,name:e.currentTarget.value})})]}}),e(t,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(n,{for:"path",display:"flex",alignItems:"center",get children(){return c("metas.path")}}),e(C,{id:"path",get value(){return l.path},onChange:e=>l.onChange({...l,path:e})})]}}),e(a,{direction:{"@initial":"row","@xl":"column"},justifyContent:{"@xl":"center"},spacing:"$1",get children(){return e(i,{colorScheme:"danger",onClick:async()=>{l.onDelete()},get children(){return c("global.delete")}})}})]}})},J=t=>{const r=s();return console.log(t.buckets),e(o,{alignItems:"start",w:"$full",get children(){return[e(n,{display:"flex",alignItems:"center",get children(){return r("settings.s3_buckets")}}),e(i,{onClick:()=>{t.setSettings(e=>"s3_buckets"===e.key,"value",JSON.stringify([...t.buckets,{name:"",path:""}])),console.log(t.buckets)},get children(){return r("global.add")}}),e(l,{get each(){return t.buckets},children:n=>e(D,c(n,{onChange:e=>{console.log(e),t.setSettings(e=>"s3_buckets"===e.key,"value",JSON.stringify(t.buckets.map(t=>t.name===n.name?e:t)))},onDelete:()=>{t.setSettings(e=>"s3_buckets"===e.key,"value",JSON.stringify(t.buckets.filter(e=>e.name!==n.name)))}}))})]}})},N=e=>{const t={...e.find(e=>"s3_buckets"===e.key)};return t.value?JSON.parse(t.value):[]},O=()=>{const t=s();x("manage.sidemenu.s3");const[n,r]=g(()=>u.get(`/admin/setting/list?group=${S.S3}`)),[a,l]=d([]),C=async()=>{const e=await r();y(e,l)};C();const[D,O]=g(()=>u.post("/admin/setting/save",m(a))),[R,q]=h(!1);return e(o,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[e(j,{get children(){return[e(p,{each:a,children:(n,s)=>e(f,{get when(){return"s3_buckets"!=n().key},get children(){return e($,c(n,{onChange:e=>{l(e=>n().key===e.key,"value",e)},onDelete:async()=>{q(!0);const e=await u.post(`/admin/setting/delete?key=${n().key}`);q(!1),y(e,()=>{k.success(t("global.delete_success")),C()})}}))}})}),e(i,{onClick:()=>{const e=I.lib.WordArray.random(15),t=I.lib.WordArray.random(30),n=I.enc.Base64.stringify(e).replace(/[\r\n]/g,""),s=I.enc.Base64.stringify(t).replace(/[\r\n]/g,"");l(e=>"s3_access_key_id"===e.key,"value",n),l(e=>"s3_secret_access_key"===e.key,"value",s)},get children(){return t("settings.s3_generate")}}),e(b,{get children(){return t("settings.s3_restart_to_apply")}}),e(J,{get buckets(){return N(a)},setSettings:l})]}}),e(_,{spacing:"$2",get children(){return[e(i,{colorScheme:"accent",onClick:C,get loading(){return n()||R()},get children(){return t("global.refresh")}}),e(i,{get loading(){return D()},onClick:async()=>{const e=N(a),n=new Set;for(const r of e){if(""===r.name||""===r.path)return void k.error(t("settings.s3_buckets_empty"));if(n.has(r.name))return void k.error(t("settings.s3_buckets_duplicate_name"));n.add(r.name)}const s=await O();y(s,async()=>{k.success(t("global.save_success")),v(await u.get("/public/settings"),w)})},get children(){return t("global.save")}})]}})]}})};export{O as default};
