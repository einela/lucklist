import{j as e,b9 as r,en as t,eo as n,O as a,B as i,C as s,D as o,a1 as l,W as c,X as d,R as u,a0 as g,a8 as h,a9 as p,aa as m,S as f,ag as w,o as b,ao as j,ah as $,U as x,ab as _,dm as k,bT as y,aw as v,aM as C,aE as P,q as S,cA as z,cM as M,$ as A,av as O,ep as T,bU as q,cD as E,aQ as I,aW as L,a5 as U,a6 as B,_ as D,aT as J}from"./index-C_g2pi0Z.js";import{L as N,c as R}from"./List-Cv5qRWEB.js";import{d as W,g as F}from"./index-DJbwiRYC.js";import H from"./Password-T1NhkSZZ.js";import{u as Q}from"./helper-sowZH77k.js";import{g as X}from"./icon-Bsr_iDeP.js";import{b as G,x as K,w as V}from"./style-CDMzdolg.js";import"./Layout-Bzme3dyC.js";import"./useTitle-a7nPsmVE.js";import"./FolderTree-BBXJf3vD.js";import"./index-DCAvcVIo.js";import"./index-B5f7FnMG.js";import"./share-CvvitCHF.js";import"./index-CRWiqiAK.js";const Y=e=>{window.open(e,"_blank")},Z=e=>{const{show:r}=G({id:2}),{isMouseSupported:t}=Q(),n=()=>S.list_item_filename_overflow;return o(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return o(v,{class:"list-item viselect-item",get"data-index"(){return e.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:A()}},get cursor(){return t()?"default":"pointer"},"on:click":r=>{e.obj.is_dir?e.jumpCallback():e.url&&Y(e.url)},onContextMenu:t=>{r(t,{props:e})},get children(){return[o(v,{class:"name-box",spacing:"$1",get w(){return R[0].w},get children(){return[o(C,{class:"icon",boxSize:"$6",get color(){return P()},get as(){return X(e.obj)},mr:"$1"}),o(w,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:"multi_line"===n()?"unset":"nowrap","overflow-x":"scrollable"===n()?"auto":"hidden",textOverflow:"ellipsis"===n()?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return e.obj.name},get children(){return e.obj.name}})]}}),o(w,{class:"size",get w(){return R[1].w},get textAlign(){return R[1].textAlign},get children(){return z(e.obj.size)}}),o(w,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return R[2].w},get textAlign(){return R[2].textAlign},get children(){return M(e.obj.modified)}})]}})}})},ee={extract:{icon:F,color:"$success9"},copy_link:{icon:W,color:"$info9"},download:{icon:J,color:"$primary9"}},re=()=>{const{copy:r}=q(),{colorMode:t}=E(),{isShare:n}=e();return o(V,{id:2,animation:"scale",get theme(){return"dark"!==t()?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[o(K,{hidden:({props:e})=>e.obj.is_dir,onClick:({props:e})=>{Y(e.url)},get children(){return o(te,{name:"download"})}}),o(K,{hidden:({props:e})=>e.obj.is_dir,onClick:({props:e})=>{r(e.url)},get children(){return o(te,{name:"copy_link"})}}),o(K,{hidden:()=>{const e=L.findIndex(e=>"decompress"===e);return!n()&&!U.can(B(),e)},onClick:({props:e})=>{I.emit("extract",JSON.stringify({inner:e.innerPath,pass:e.pass}))},get children(){return o(te,{name:"extract"})}})]}})},te=e=>{const r=b();return o(v,{spacing:"$2",get children(){return[o(C,{get p(){return ee[e.name].p?"$1":void 0},get as(){return ee[e.name].icon},boxSize:"$7",get color(){return ee[e.name].color}}),o(w,{get children(){return r(`home.toolbar.${e.name}`)}})]}})},ne=()=>{const v=b(),{pathname:C}=e(),[P,S]=r(t),[z,M]=r(n),A=a(()=>P()||z());let O="",q="",E="",I=null;const[L,U]=i(""),[B,J]=i(!1),[R,W]=i(!1),[F,Q]=i(""),[X,G]=i([]),[K,V]=i(),[Y,ee]=i(!1),[te,ne]=i(""),ae=function(){let e=!1,r=[];return{acquire:()=>new Promise(t=>{e?r.push(t):(e=!0,t())}),release:()=>{r.length>0?r.shift()():e=!1}}}(),ie=e=>{let r={};return e.forEach(e=>{r[e.name]={...e,children:e.children?ie(e.children):null}}),r},se=e=>200!==e.code&&(202===e.code?y(()=>{""!==O&&J(!0),W(!0),U("")}):U(e.message),!0),oe=async e=>{if(await ae.acquire(),R()&&""===O)return ae.release(),[];if(""===q){const e=await S(C(),D(),O);if(se(e))return ae.release(),[];if(null!==e.data.content&&(I=ie(e.data.content)),q=e.data.raw_url,E=e.data.sign,Q(e.data.comment),void 0!==e.data.sort){let r;""!==e.data.sort.order_by&&(r=e.data.sort.order_by);let t="desc"===e.data.sort.order_direction,n=e.data.sort.extract_folder;y(()=>{V(r),ee(t),ne(n)})}if(e.data.encrypted&&""===O)return y(()=>{W(!0),U("")}),ae.release(),[]}if(null===I){const e=await M(C(),D(),O,"/");if(se(e))return ae.release(),[];I=ie(e.data.content)}let r=I;for(let t=0;t<e.length;t++){if(null===r[e[t]].children){const n=await M(C(),D(),O,"/"+e.slice(0,t+1).join("/"));if(se(n))return ae.release(),[];r[e[t]].children=ie(n.data.content)}r=r[e[t]].children}return y(()=>{W(!1),J(!1),U("")}),ae.release(),Object.values(r)},[le,ce]=i([]);s(()=>{oe(X()).then(e=>ce(e))});const de=()=>{oe(X()).then(e=>ce(e))};de();const ue=(e,r)=>{y(()=>{ne(""),V(e),void 0!==r&&ee(r)})};return o($,{spacing:"$2",w:"$full",get children(){return[o(l,{pl:"$2",pr:"$2",w:"$full",get children(){return[o(c,{get children(){return o(d,{get currentPage(){return 0===X().length},"on:click":()=>G([]),children:"."})}}),o(u,{get each(){return X()},children:(e,r)=>o(c,{get children(){return[o(g,{}),o(d,{get currentPage(){return X().length===r()+1},"on:click":()=>G(X().slice(0,r()+1)),children:e})]}})})]}}),o(h,{get children(){return[o(p,{get when(){return""!==L()},get children(){return o(m,{get msg(){return L()},disableColor:!0})}}),o(p,{get when(){return R()},get children(){return o(H,{get title(){return v("home.toolbar.archive.input_password")},password:()=>O,setPassword:e=>O=e,enterCallback:()=>de(),get children(){return o(f,{get when(){return B()},get children(){return o(w,{color:"$danger9",get children(){return v("home.toolbar.archive.incorrect_password")}})}})}})}}),o(p,{get when(){return _(()=>!R())()&&""===L()},get children(){return o(j,{get loading(){return A()},get children(){return o($,{class:"list",w:"$full",spacing:"$1",get children(){return[o(N,{sortCallback:ue,disableCheckbox:!0}),o(u,{get each(){return(()=>{let e=le();K()&&(e=e.sort((e,r)=>(Y()?-1:1)*T(e[K()],r[K()])));let r=te();if(""!==r){let t=[],n=[];e.forEach(e=>(e.is_dir?t:n).push(e)),e="front"===r?t.concat(n):n.concat(t)}return e})()},children:(e,r)=>{let t,n=(X().length>0?"/"+X().join("/"):"")+"/"+e.name;if(!e.is_dir){const e=q.includes("?");t=q+`${e?"&":"?"}inner=${x(n,!0)}`,""!==O&&(t+=`&pass=${encodeURIComponent(O)}`),""!==E&&(t+=`&sign=${E}`)}return o(Z,{obj:e,get index(){return r()},jumpCallback:()=>G(X().concat(e.name)),innerPath:n,url:t,pass:O})}}),o(re,{})]}})}})}})]}}),o(f,{get when(){return""!==F()},get children(){return[o(k,{}),o(w,{w:"$full",pl:"$1",pr:"$1",get children(){return F()}})]}})]}})};export{ne as default};
